extends ../layouts/default
include ./sandbox

block main
  .course-container
    //- .course-header.hero
    //-   .container
    //-     h1 !{title}
    //-     p.heading-5 !{caption}

    +hero(
      title,
      caption
    )

    .neutral
      .container
        .course-overview(class=completed ? 'course--completed' : '')
          .card
            .card-header
              h2.card-title #{translate('course-overview', 'Course Overview')}

              if !completed
                if interested
                  a.course-bookmark.course-bookmark--remove(href=`${link}bookmark/remove/`)
                    | #{translate('remove-bookmark', 'Remove Bookmark')}
                    | !{svg.iconBookmark}
                else
                  a.course-bookmark(href=`${link}bookmark/`)
                    | #{translate('add-bookmark', 'Bookmark Course')}
                    | !{svg.iconBookmark}

            .card-body
              if completed
                .course-completed
                  .course-badge
                    a(href=`/u/${user.id}/${slug}`)
                      | !{badge}
                  .congratulations
                    .overline #{translate('completed-overline', 'Great work!')}
                    p #{translate('completed-prefix', 'You have completed the ')}
                      |
                      | !{title}
                      |
                      | #{translate('completed-suffix', ' course!')}
              else if video
                iframe(src=video, width="560" height="280", frameborder, allowfullscreen="")
              else
                img(src='/img/course-placeholder.jpg', alt=title, width=448, height=279)

            if user && enrolled && completed === false && next
              .card-body
                //- if completedPercentage

                .progress-container
                  .progress-header
                    h2 #{translate('your-progress', 'Your Progress')}
                    .progress-percentage
                      | #{completedPercentage}%

                  div.progress-bar
                    div.progress-bar-container
                      span(style=`width: ${completedPercentage}%`) #{completedPercentage}%

                a.btn.btn--primary(href=next.link) #{translate('continue-course', 'Continue Course')}
            else if status == statuses.STATUS_DRAFT
              .card-body.course-coming-soon
                if isInterested === true || (messages['success'] && messages['success'][0].includes('Your interest'))
                  .admonition.admonition--positive #{translate('interest-confirmation', 'Thank you for registering your interest. We will contact you when the course is available.')}
                else
                  //- h3.card-title #{translate('coming-soon-title', 'Course Coming Soon')}
                  //- p #{translate('coming-soon-text', 'We are currently working on this course.  Fill in the form below to register your interest and we will contact you when it is ready.')}

                  | !{translate('course-coming-soon', 'Coming Soon')}

                  form.form(method='POST' action=`${link}interested`)
                    .form-group
                      label !{translate('email-address', 'Email Address')}
                      input#email(type="email" name="email", value=user ? user.email : '' placeholder=translate('email-address-placeholder', 'Your email address'))
                    .form-buttons
                      button.btn !{translate('register-interest', 'Register Interest')}
            else if user && completed
              .card-body
                //- .progress-container
                //-   .progress-header
                //-     h2 Your Progress
                //-     .progress-percentage
                //-       | 100%

                  div.progress-bar
                    div.progress-bar-container
                      span(style=`width: 100%`) 100%

                a.btn.btn--primary(href=`/u/${user.id}/${slug}`) !{translate('view-certificate', 'View Certificate')}

            else if user
              .card-actions
                a.btn.btn--success.course-enrol-link(href=`${link}enrol`) !{translate('enroll-now', 'Enroll Now')}


            else
              .card-actions
                a.btn(href=`/login?returnTo=${link}enrol`) !{translate('sign-in-to-enroll', 'Sign in or Register to continue')}

          if status == statuses.STATUS_DRAFT && user && user.email.endsWith('@neotechnology.com') && modules.length && !enrolled
            .course-sandbox.card
              .card-header
                h3 Enroll Anyway
              .card-body
                p Your email address ends with neotechnology.com, so you can enroll to preview this course.
                  | Remember, this course is a work in progress so some aspects may be incomplete.  If you have any comments, please email
                  a(href=`mailto:graphacademy.neo4j.com?subject=${encodeURIComponent('Course Preview Feedback: '+ title)}`) !{' '} graphacademy@neo4j.com.
              .card-actions
                a.btn.btn--success.course-enrol-link(href=`${link}enrol`) Enroll Anyway

          if sandbox
            .course-sandbox.card
              //- .card-header
                //- h3 !{translate('sandbox-title', 'Sandbox')}

              .card-body
                | !{translate('sandbox-description', '')}

                //- p The code challenges in this course are run against a
                //-   |
                //-   |
                //-   a(href='https://sandbox.neo4j.com' target='_blank') Neo4j Sandbox
                //-   |
                //-   |
                //-   | instance that we have created for you
                //-   if usecase != 'blank-sandbox'
                //-     |
                //-     | with data from the #{usecase} use case
                //-   |
                //-   | . You can view the instance in Neo4j Sandbox by clicking the Sandbox URL below.

                +sandbox(sandbox)

          include ./partials/path

          include ./partials/translations

          if user && enrolled
            .course-unenrol
              a.course-unenrol-link(href=`${link}unenrol`) !{translate('unenroll', 'Unenroll from course')}

        .course-details
          //- .course-meta
          //-   if duration
          //-     dl.course-meta-list
          //-       dt.course-meta-term
          //-         | !{svg.iconDurationLarge}
          //-         span Course Duration
          //-       dd.course-meta-details
          //-         | !{duration}
          //-   if modules && modules.length > 0
          //-     dl.course-meta-list
          //-       dt.course-meta-term
          //-         | !{svg.iconBookLarge}
          //-       span Course Length
          //-       dd.course-meta-details #{modules.length}
          //-         |
          //-         | Modules

          .tabs
            a.tab-element.tab--selected(href='#description') !{translate('description', 'Description')}
            if modules && modules.length
              a.tab-element(href='#toc') !{translate('table-of-contents', 'Table of Contents')}
            a.tab-element(href='#support') !{translate('support-and-feedback', 'Support &amp; Feedback')}

          #description.tab-target.tab-target--visible.course-description.doc
            if doc
              | !{doc}
            else
              h2 #{translate('coming-soon', 'Coming Soon')}
              if status == statuses.STATUS_DRAFT
                p !{translate('coming-soon-draft')}
              else
                p !{translate('coming-soon-unknown')}

          if modules && modules.length
            //- #toc.tab-target.course-toc
            #toc.tab-target.course-toc
              h2 !{translate('table-of-contents', 'Table of Contents')}

              .toc
                include ../partials/toc

          #support.tab-target
            | !{translate('overviewsupport')}
            | !{translate('overviewfeedback')}


  //- include ../partials/community-cutout.pug

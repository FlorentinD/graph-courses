= Adding the Driver
:type: challenge
:branch: 01-connect-to-neo4j
:test-number: 01

This is your first challenge of this course.
Your challenge here is to modify the code to create a new instance of the Driver that can be used across the application.

As we discussed in the link:../1-about/[About the Driver lesson], it is best practise to create a single instance of the driver in our application.

Inside `src/neo4j.js`, you will see an `initDriver` function, and above a `let driver` declaration.

.src/neo4j.js
[source,js]
----
include::{repository-raw}/main/src/neo4j.js[tag=driver]

include::{repository-raw}/main/src/neo4j.js[tag=initDriver]
----

This function should use the `uri`, `username` and `password` parameters supplied to create an instance of the Neo4j JavaScript Driver and assign it to the `driver` variable.

Below, the `getDriver` function will provide other modules in the application with access to the `driver` variable set in `initDriver`.

.src/neo4j.js
[source,js]
----
include::{repository-raw}/main/src/neo4j.js[tag=getDriver]
----



== Challenge: Implement the initDriver function.

Your first challenge is to modify the `initDriver` in `src/neo4j.js` to create an instance of the driver and assign it to the `driver` variable declared above.
To do this, we will need to:

1. Install the `neo4j-driver` dependency
2. Import the dependency into `neo4j.js`
3. Create the driver instance with the  `uri`, `username` and `password` parameters passed to the function and use se the `verifyConnectivity` to assert that the credentials are correct.


=== 1. Install the neo4j-driver Dependency

First, you will need to install the `neo4j-driver` dependency.
Run the following command in a new terminal session:

[.tab]
.NPM
====
.Install neo4j-driver using NPM
[source,sh]
----
include::{repository-raw}/main/example/install.txt[tag="npm"]
----
====

[.tab]
.Yarn
====
.Install neo4j-driver using Yarn
[source,sh]
----
include::{repository-raw}/main/example/install.txt[tag="yarn"]
----
====

[TIP]
Using the `--save` option will add the entry to the list of dependencies in our `package.json` file.


// == Creating the Driver

// === 2. Update your Environment Variables

// Hardcoding the connection variables into this module is considered bad practise.
// As we already have the `dotenv` library set up, we can instead read these values from `.env`, giving us the benefit of being able to easily update these in development, testing or production environments.

// A Neo4j Sandbox instance was created as part of your enrollment to this course.
// The credentials for the sandbox are listed below, so you can simply copy and paste the credentials into the `.env` file.



// === Accessing the Environment Variables

// These variables can only be accessed after the `config` function has been called from the `dotenv` library.

// If we open up `src/index.js`, we can see that early on, the `config` function is called which reads the config from `.env`.

// [source,js,rel=nocopy]
// .Reading Environment Variables from .env
// ----
// include::{repository-raw}/main/example/environment.js[]
// ----


// Once the `config` function has been called, the variables will be assigned to the `process.env` object.


// If we look a little futher on down the file, there is a call to the `initDriver` function, which is imported from `src/neo4j.js`.


// If we open `src/neo4j.js`, we will first see a reference to a `driver` variable that is as yet undefined, and below an `initDriver` function.


.src/neo4j.js
[source,js]
----
include::{repository-raw}/main/src/neo4j.js[tag=driver]

include::{repository-raw}/main/src/neo4j.js[tag=initDriver]
----


=== 2. Importing the Dependency

To include the Driver dependency in our module, we'll need to add an `import` command to the top of the file.
Copy and paste the following code into the top of `src/neo4j.js`.

[source,js,subs="attributes+"]
----
include::{repository-raw}/main/example/index.js[tag=import]
----


=== 3. Creating the Driver Instance

Create the driver instance by calling the `neo4j.driver` method.
The first argument will be the `uri` passed as the first parameter to the function.
The second argument will be an authentication token which can be created using the `neo4j.auth.basic` function, this takes two arguments; `username` and `password`


Replace the `initDriver` placeholder function with the following code:

.src/neo4j.js
[source,js]
----
include::{repository-raw}/{branch}/src/neo4j.js[tag=driver]

include::{repository-raw}/{branch}/src/neo4j.js[tag=initDriver]
----

In the last line of the function above, the `verifyConnectivity` function will verify that the connection details are correct.

If the connection cannot be made for any reason, the Promise will be rejected and server will fail to start.

If the connection has been successfully verified, the Promise will resolve with an instance of the driver.




// == Testing Connectivity
include::../../../../includes/test.adoc[]

// To test that the driver has been setup correctly, run the following command in a new terminal session:

// [source,sh]
// npm run test 01

// The test file is located at `test/challenges/01-connecting-to-neo4j.spec.js`.

== Check Your Understanding

include::./questions/1-test-number.adoc[leveloffset=+1]

[.summary]
== Lesson Summary

We have implemented the code to create a new driver instance with environment variables read from the `.env` file and verifies that the driver can connect to the Neo4j instance before the server starts.

In the next module we will look at how we can use the driver to query a Neo4j database.

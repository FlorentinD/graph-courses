= Troubleshooting Common Issues
:order: 6

This lesson covers some of the more common error messages that you may see when using the drivers and some steps that you can take to resolve them.

== Connection Errors

The following errors may occur either when you attempt to verify connectivity, or when you attempt to run your first query.

// == Incorrect Server URL
=== Could not perform discovery

[source]
UnhandledPromiseRejectionWarning: Neo4jError: Could not perform
discovery. No routing servers available. Known routing table:
RoutingTable[database=default database, expirationTime=0,
currentTime=1634844853479, routers=[], readers=[], writers=[]]

This error indicates that the driver is unable to connect to the server as defined in the connection string.
You can catch this error early by calling `driver.verifyConnectivity()`.

To resolve this problem, you should try the following:

1. Verify the Server URL - can you `ping` the address, or access the browser via port `7474`?
2. If the address is correct, try verifying the port number.  Has the `dbms.connector.bolt.listen_address` setting changed in `neo4j.conf`?
3. Is access to the port enabled on your servers firewall?
4. If all above is correct, double check the scheme used within the connection string as per the instructions in link:../3-connection-strings/[Connecting to Neo4j].


=== The client is unauthorized due to authentication failure

[source]
Neo4jError: The client is unauthorized due to authentication failure.
  code: 'Neo.ClientError.Security.Unauthorized'

This error indicates the the driver can successfully connect to the server, but the credentials that have been provided are incorrect.  Check the username and password.

=== Server responded HTML

[source]
UnhandledPromiseRejectionWarning: Neo4jError: Server responded HTTP.
Make sure you are not trying to connect to the http endpoint
(HTTP defaults to port 7474 whereas BOLT defaults to port 7687)

This error occurs when a HTTP response is returned by the server rather than the bolt response that the driver was expecting.
Try checking the port number, and verifying whether the `dbms.connector.bolt.listen_address` setting has been changed in `neo4j.conf`.


== Errors when executing a query

=== Incorrect DB

[source]
Neo4jError: Unable to get a routing table for database '[DBNAME]'
because this database does not exist

This error indicates that the database passed as an option to `driver.session` does not exist.  Verify that the database exists on the server that you are trying to connect to.


=== Miscellaneous Cypher Syntax Errors

[source]
Neo4jError: Variable `node` not defined (line 1, column 18 (offset: 17))
"MATCH (n) RETURN node"
                  ^

If for any reason there is an error in your query, an error will be thrown with details contained in the `message` property.
In most cases, the error message points to the problem in question.

[source,js]
----
try {
  const res = tx.run(`MATCH (n) RETURN node`)
  //...
}
catch (e) {
  console.log(e.message) // Error message
}
----

Hopefully you will never come across these errors, but if you do then you should have a good understanding of how to solve them.


For more common driver errors, you can link:https://community.neo4j.com/t/troubleshooting-connection-issues-to-neo4j/129/10[read this thread on the Neo4j Community Site^].

== Check Your Understanding

* TODO


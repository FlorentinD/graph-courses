= Adding Language nodes
:type: challenge
:order: 4
:sandbox: true

This is what the instance model will be refactored to:

image::images/instance-add-language-node.png[Instance model with language node,width=400,align=center]

Execute this code to refactor the graph to turn the _languages_ property values into _Language_ nodes:

[source,cypher]
----
MATCH (m:Movie)
UNWIND m.languages AS language
WITH  language, collect(m) AS movies
MERGE (l:Language {name:language})
WITH l, movies
UNWIND movies AS m
WITH l,m
MERGE (m)-[:IN_LANGUAGE]->(l);
MATCH (m:Movie)
SET m.languages = null
----

This is the Cypher code for what our use case used to be before the refactoring.
Modify this code to support the refactored graph:

[source,cypher, role=noplay]
----
MATCH (m:Movie)
WHERE 'Italian' IN m.languages
RETURN m.title
----

// Question??? How can we test that the user rewrte the query correctly (solution.cypher) contains the solution.

This is the only use case that deals with languages so we need not retest all of our queries after the refactor.

include::./questions/verify.adoc[]

[.summary]
== Summary

In this challenge, you demonstrated that you can refactor the graph to add nodes to replace duplication in properties.

In the next challenge, you will perform some additional factoring to eliminate duplication.

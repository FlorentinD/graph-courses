= Retesting After Refactoring
:type: quiz
:order: 4


[.video]
video::xxxx[youtube,width=560,height=315]


[.transcript]

== Retesting after refactoring

After you have refactored the graph, you should revisit all queries for your use cases.

You should first determine if any of the queries need to be rewritten to take advantage of the refactoring.

Next, we rewrite some of our queries to take advantage of the refactoring.

=== 1. What people acted in a movie?

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)-[:ACTED_IN]-(m:Movie)
WHERE m.title = 'Sleepless in Seattle'
RETURN p.name AS Actor
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)-[:ACTED_IN]-(m:Movie)
WHERE m.title = 'Sleepless in Seattle'
RETURN p.name AS Actor
----

=== 3. What movies did a person act in?

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)-[:ACTED_IN]-(m:Movie)
WHERE p.name = 'Tom Hanks'
RETURN m.title AS Movie
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)-[:ACTED_IN]-(m:Movie)
WHERE p.name = 'Tom Hanks'
RETURN m.title AS Movie
----

=== 5. Who was the youngest person to act in a movie?

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)-[:ACTED_IN]-(m:Movie)
WHERE m.title = 'Hoffa'
RETURN  p.name AS Actor, p.born as `Year Born` ORDER BY p.born DESC LIMIT 1
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)-[:ACTED_IN]-(m:Movie)
WHERE m.title = 'Hoffa'
RETURN  p.name AS Actor, p.born as `Year Born` ORDER BY p.born DESC LIMIT 1
----

=== 6. What role did a person play in a movie?

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)-[r:ACTED_IN]-(m:Movie)
WHERE m.title = 'Sleepless in Seattle' AND
p.name = 'Meg Ryan'
RETURN  r.role AS Role
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)-[r:ACTED_IN]-(m:Movie)
WHERE m.title = 'Sleepless in Seattle' AND
p.name = 'Meg Ryan'
RETURN  r.role AS Role
----

=== 8. What drama movies did an actor act in?

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)-[:ACTED_IN]-(m:Movie)
WHERE p.name = 'Tom Hanks' AND
'Drama' IN m.genres
RETURN m.title AS Movie
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)-[:ACTED_IN]-(m:Movie)
WHERE p.name = 'Tom Hanks' AND
'Drama' IN m.genres
RETURN m.title AS Movie
----

=== 10. What actors were born before 1950?

For completeness of our testing, we add this new use case.

We rewrite this query to use the _Actor_ label.

Original code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Person)
WHERE p.born < '1950'
RETURN p.name
----

New code:

[source,cypher,role=nocopy noplay]
----
MATCH (p:Actor)
WHERE p.born < '1950'
RETURN p.name
----

== Check your understanding


include::questions/1-retest.adoc[]


[.summary]
== Summary

In this lesson, you learned that you may need to rewrite your Cypher that supports your use cases before you retest after refactoring.
In the next challenge, you will retest all use cases because you have added the _Actor_ label to the graph.